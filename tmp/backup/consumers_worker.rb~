class ConsumersWorker
  include Sidekiq::Worker

  def perform
    puts "Looking for inactive consumers..."
    inactive_consumers = Consumer.where('last_signed_in_at < ?', Time.now - 2.weeks)
    puts "Found #{inactive_consumers.count} consumers"
    if inactive_consumers.count > 0
      puts "Inactivation these consumers"
      inactive_consumers.update_all('status=0')
      puts "Removing auth keys of these consumers"
      inactive_consumers.each{|x| x.api_key.destroy }
      puts "Inactived #{inactive_consumers.count} consumers!"
    end
  end
end
